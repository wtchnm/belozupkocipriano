---
import { getCollection } from 'astro:content'

const posts = await getCollection('posts')
---

<!doctype html>
<html lang='en'>
	<head>
		<meta charset='UTF-8' />
		<link rel='icon' type='image/svg+xml' href='/favicon.svg' />
		<meta name='viewport' content='width=device-width' />
		<meta name='generator' content={Astro.generator} />
		<title>Lastro</title>
		<style is:inline>
			@font-face {
				font-family: 'Inter var';
				font-style: normal;
				font-weight: 100 900;
				font-display: swap;
				src: url('/Inter.woff2') format('woff2');
				font-named-instance: 'Regular';
			}
		</style>
	</head>
	<body class='antialiased'>
		{
			posts.map(async post => {
				const { Content } = await post.render()
				return (
					<>
						<article>
							<h2>{post.data.title}</h2>
							<p>{post.data.date}</p>
							<div>
								<Content />
							</div>
						</article>
						<hr />
					</>
				)
			})
		}

		<!-- Netlify Identity -->
		<script
			is:inline
			src='https://identity.netlify.com/v1/netlify-identity-widget.js'></script>
		<script is:inline>
			if (window.netlifyIdentity) {
				window.netlifyIdentity.on('init', user => {
					if (!user) {
						window.netlifyIdentity.on('login', () => {
							document.location.href = '/admin/'
						})
					}
				})
			}
		</script>
	</body>
</html>
